import{d as me,a as pe,W as fe,c as f,w as a,e,H as v,u as ve,o as i,b as t,I as $,f as T,J as N,a0 as ge,g as z,h as c,z as C,k as d,a1 as _e,ae as Ie,af as G,v as p,i as H,m as q,q as J,j as s,t as u,y as g,M as j,E as _,ag as ye,ah as Se,ai as Ce,s as I,aj as be,ak as ke,T as O,al as Oe,am as De,an as W,ao as K,R as Ee,D as we,ap as Re,aq as Le,a6 as Ae,ar as Te,n as Ne,L as xe,ab as he,as as Be,at as Ue,ac as Me,S as Pe,U as Ve,au as Fe,F as $e,G as ze,V as Q,av as X,aw as Ge,ax as He,ay as qe,O as Je,az as je,_ as We}from"./index-BXUmX6Np.js";import{u as Ke,t as Qe,a as Xe,p as Ye}from"./signalementStore-Ckdo4sEA.js";const Ze={class:"recap-grid"},et={class:"recap-item"},tt={class:"recap-number"},lt={class:"recap-item"},at={class:"recap-number text-primary"},nt={class:"recap-item"},st={class:"recap-number text-warning"},ot={class:"recap-item"},ut={class:"recap-number text-success"},rt={class:"date-text"},it={key:2,class:"empty-state"},dt={key:0},ct={key:1},mt={key:3,class:"loading-state"},pt={class:"status-badges"},ft={class:"detail-title"},vt={key:1,class:"detail-actions"},gt=me({__name:"SignalementsPage",setup(_t){const Y=ve(),m=Ke(),Z=pe(),y=v("tous"),D=v(!1),o=v(null),E=v(!1),b=v(null),w=v(!1),R=v(""),L=v("success"),S=Q(()=>m.recap),x=Q(()=>y.value==="mes"?m.mesSignalements:m.signalements),ee=[{text:"Annuler",role:"cancel"},{text:"Supprimer",role:"destructive",handler:()=>de()}],h=n=>Qe[n]||n,B=n=>Xe[n]||n,te=n=>Ye[n]||n,le=n=>({NOUVEAU:"#3880ff",EN_COURS:"#ffc409",RESOLU:"#2dd36f",REJETE:"#eb445a"})[n]||"#92949c",U=n=>({NOUVEAU:"primary",EN_COURS:"warning",RESOLU:"success",REJETE:"danger"})[n]||"medium",ae=n=>({BASSE:"medium",NORMALE:"primary",HAUTE:"warning",URGENTE:"danger"})[n]||"medium",M=n=>({NID_DE_POULE:je,FISSURE:Je,INONDATION:qe,OBSTACLE:He,ECLAIRAGE:Ge,SIGNALISATION:K,AUTRE:X})[n]||X,ne=n=>(n instanceof Date?n:new Date(n)).toLocaleDateString("fr-FR",{day:"2-digit",month:"short",year:"numeric"}),P=n=>n?(n instanceof Date?n:new Date(n)).toLocaleDateString("fr-FR",{day:"2-digit",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"}):"Non disponible",V=n=>n.createdById===Z.userId,k=async()=>{y.value==="mes"?await m.fetchMesSignalements():await m.fetchAll(),await m.fetchRecap()},se=async n=>{await k(),n.target.complete()},oe=async()=>{await k()},ue=n=>{o.value=n,D.value=!0},A=()=>{D.value=!1,o.value=null},re=()=>{Y.push("/map")},ie=()=>{if(!o.value)return;const{latitude:n,longitude:l}=o.value;window.open("https://www.google.com/maps?q=".concat(n,",").concat(l),"_blank")},F=n=>{b.value=n,E.value=!0},de=async()=>{if(!b.value)return;const n=await m.deleteSignalement(b.value.id);n.success?(R.value="Signalement supprimé",L.value="success",A()):(R.value=n.message||"Erreur lors de la suppression",L.value="danger"),w.value=!0,b.value=null};return fe(async()=>{await k()}),(n,l)=>(i(),f(e(ze),null,{default:a(()=>[t(e($),null,{default:a(()=>[t(e(T),{color:"primary"},{default:a(()=>[t(e(N),{slot:"start"},{default:a(()=>[t(e(ge))]),_:1}),t(e(z),null,{default:a(()=>[...l[5]||(l[5]=[c("Signalements",-1)])]),_:1}),t(e(N),{slot:"end"},{default:a(()=>[t(e(C),{onClick:k},{default:a(()=>[t(e(d),{icon:e(_e)},null,8,["icon"])]),_:1})]),_:1})]),_:1}),t(e(T),null,{default:a(()=>[t(e(Ie),{modelValue:y.value,"onUpdate:modelValue":l[0]||(l[0]=r=>y.value=r),onIonChange:oe},{default:a(()=>[t(e(G),{value:"tous"},{default:a(()=>[t(e(p),null,{default:a(()=>[...l[6]||(l[6]=[c("Tous",-1)])]),_:1})]),_:1}),t(e(G),{value:"mes"},{default:a(()=>[t(e(p),null,{default:a(()=>[...l[7]||(l[7]=[c("Mes signalements",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),t(e(H),null,{default:a(()=>[S.value?(i(),f(e(q),{key:0,class:"recap-card"},{default:a(()=>[t(e(J),null,{default:a(()=>[s("div",Ze,[s("div",et,[s("span",tt,u(S.value.total),1),l[8]||(l[8]=s("span",{class:"recap-label"},"Total",-1))]),s("div",lt,[s("span",at,u(S.value.nouveaux),1),l[9]||(l[9]=s("span",{class:"recap-label"},"Nouveaux",-1))]),s("div",nt,[s("span",st,u(S.value.enCours),1),l[10]||(l[10]=s("span",{class:"recap-label"},"En cours",-1))]),s("div",ot,[s("span",ut,u(S.value.resolus),1),l[11]||(l[11]=s("span",{class:"recap-label"},"Résolus",-1))])])]),_:1})]),_:1})):g("",!0),x.value.length>0?(i(),f(e(j),{key:1},{default:a(()=>[(i(!0),_(ye,null,Se(x.value,r=>(i(),f(e(Ce),{key:r.id},{default:a(()=>[t(e(I),{button:"",onClick:ce=>ue(r)},{default:a(()=>[t(e(be),{slot:"start",style:ke({background:le(r.statut)})},{default:a(()=>[t(e(d),{icon:M(r.typeProbleme),color:"light"},null,8,["icon"])]),_:2},1032,["style"]),t(e(p),null,{default:a(()=>[s("h2",null,u(r.titre),1),s("p",null,u(h(r.typeProbleme))+" - "+u(r.adresse||"Sans adresse"),1),s("p",rt,u(ne(r.dateSignalement)),1)]),_:2},1024),t(e(O),{slot:"end",color:U(r.statut),size:"small"},{default:a(()=>[c(u(B(r.statut)),1)]),_:2},1032,["color"])]),_:2},1032,["onClick"]),V(r)?(i(),f(e(Oe),{key:0,side:"end"},{default:a(()=>[t(e(De),{color:"danger",onClick:ce=>F(r)},{default:a(()=>[t(e(d),{icon:e(W),slot:"icon-only"},null,8,["icon"])]),_:1},8,["onClick"])]),_:2},1024)):g("",!0)]),_:2},1024))),128))]),_:1})):e(m).isLoading?g("",!0):(i(),_("div",it,[t(e(d),{icon:e(K),class:"empty-icon"},null,8,["icon"]),l[13]||(l[13]=s("h3",null,"Aucun signalement",-1)),y.value==="mes"?(i(),_("p",dt,"Vous n'avez pas encore créé de signalement.")):(i(),_("p",ct,"Aucun signalement n'a été enregistré.")),t(e(C),{onClick:re},{default:a(()=>[t(e(d),{icon:e(Ee),slot:"start"},null,8,["icon"]),l[12]||(l[12]=c(" Créer un signalement ",-1))]),_:1})])),e(m).isLoading?(i(),_("div",mt,[t(e(we),{name:"crescent"}),l[14]||(l[14]=s("p",null,"Chargement...",-1))])):g("",!0),t(e(Re),{slot:"fixed",onIonRefresh:l[1]||(l[1]=r=>se(r))},{default:a(()=>[t(e(Le))]),_:1})]),_:1}),t(e(Ae),{"is-open":D.value,onDidDismiss:A},{default:a(()=>[t(e($),null,{default:a(()=>[t(e(T),{color:"primary"},{default:a(()=>[t(e(N),{slot:"start"},{default:a(()=>[t(e(C),{onClick:A},{default:a(()=>[t(e(d),{icon:e(Te)},null,8,["icon"])]),_:1})]),_:1}),t(e(z),null,{default:a(()=>[...l[15]||(l[15]=[c("Détails du signalement",-1)])]),_:1})]),_:1})]),_:1}),o.value?(i(),f(e(H),{key:0,class:"ion-padding"},{default:a(()=>[s("div",pt,[t(e(O),{color:U(o.value.statut)},{default:a(()=>[c(u(B(o.value.statut)),1)]),_:1},8,["color"]),t(e(O),{color:ae(o.value.priorite)},{default:a(()=>[c(u(te(o.value.priorite)),1)]),_:1},8,["color"])]),s("h1",ft,u(o.value.titre),1),t(e(O),{color:"medium"},{default:a(()=>[t(e(d),{icon:M(o.value.typeProbleme)},null,8,["icon"]),t(e(p),null,{default:a(()=>[c(u(h(o.value.typeProbleme)),1)]),_:1})]),_:1}),o.value.description?(i(),f(e(q),{key:0},{default:a(()=>[t(e(Ne),null,{default:a(()=>[t(e(xe),null,{default:a(()=>[...l[16]||(l[16]=[c("Description",-1)])]),_:1})]),_:1}),t(e(J),null,{default:a(()=>[c(u(o.value.description),1)]),_:1})]),_:1})):g("",!0),t(e(j),null,{default:a(()=>[t(e(I),null,{default:a(()=>[t(e(d),{icon:e(he),slot:"start",color:"primary"},null,8,["icon"]),t(e(p),null,{default:a(()=>[l[17]||(l[17]=s("h3",null,"Adresse",-1)),s("p",null,u(o.value.adresse||"Non renseignée"),1)]),_:1})]),_:1}),t(e(I),null,{default:a(()=>[t(e(d),{icon:e(Be),slot:"start",color:"primary"},null,8,["icon"]),t(e(p),null,{default:a(()=>[l[18]||(l[18]=s("h3",null,"Coordonnées",-1)),s("p",null,u(o.value.latitude.toFixed(6))+", "+u(o.value.longitude.toFixed(6)),1)]),_:1}),t(e(C),{fill:"clear",slot:"end",onClick:ie},{default:a(()=>[t(e(d),{icon:e(Ue)},null,8,["icon"])]),_:1})]),_:1}),t(e(I),null,{default:a(()=>[t(e(d),{icon:e(Me),slot:"start",color:"primary"},null,8,["icon"]),t(e(p),null,{default:a(()=>[l[19]||(l[19]=s("h3",null,"Date du signalement",-1)),s("p",null,u(P(o.value.dateSignalement)),1)]),_:1})]),_:1}),t(e(I),null,{default:a(()=>[t(e(d),{icon:e(Pe),slot:"start",color:"primary"},null,8,["icon"]),t(e(p),null,{default:a(()=>[l[20]||(l[20]=s("h3",null,"Signalé par",-1)),s("p",null,u(o.value.createdByName||o.value.createdByEmail),1)]),_:1})]),_:1}),o.value.dateResolution?(i(),f(e(I),{key:0},{default:a(()=>[t(e(d),{icon:e(Ve),slot:"start",color:"success"},null,8,["icon"]),t(e(p),null,{default:a(()=>[l[21]||(l[21]=s("h3",null,"Date de résolution",-1)),s("p",null,u(P(o.value.dateResolution)),1)]),_:1})]),_:1})):g("",!0)]),_:1}),V(o.value)?(i(),_("div",vt,[t(e(C),{expand:"block",color:"danger",onClick:l[2]||(l[2]=r=>F(o.value))},{default:a(()=>[t(e(d),{icon:e(W),slot:"start"},null,8,["icon"]),l[22]||(l[22]=c(" Supprimer ce signalement ",-1))]),_:1})])):g("",!0)]),_:1})):g("",!0)]),_:1},8,["is-open"]),t(e(Fe),{"is-open":E.value,header:"Confirmer la suppression",message:"Êtes-vous sûr de vouloir supprimer ce signalement ?",buttons:ee,onDidDismiss:l[3]||(l[3]=r=>E.value=!1)},null,8,["is-open"]),t(e($e),{"is-open":w.value,message:R.value,color:L.value,duration:3e3,onDidDismiss:l[4]||(l[4]=r=>w.value=!1)},null,8,["is-open","message","color"])]),_:1}))}}),St=We(gt,[["__scopeId","data-v-bc7ab799"]]);export{St as default};
