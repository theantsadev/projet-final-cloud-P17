System.register(["./index-legacy-DVVyv3Gx.js","./signalementStore-legacy-CcutNPgO.js"],function(e,a){"use strict";var l,t,n,u,s,i,o,r,c,d,p,m,v,f,g,b,_,y,x,h,E,S,k,w,C,D,R,A,N,U,I,O,L,T,z,V,j,F,P,B,G,M,$,q,J,H,W,K,Q,X,Y,Z,ee,ae,le,te,ne,ue,se,ie,oe,re,ce,de,pe,me,ve,fe,ge,be;return{setters:[e=>{l=e.d,t=e.a,n=e.W,u=e.c,s=e.w,i=e.e,o=e.H,r=e.u,c=e.o,d=e.b,p=e.I,m=e.f,v=e.J,f=e.a0,g=e.g,b=e.h,_=e.z,y=e.k,x=e.a1,h=e.ae,E=e.af,S=e.v,k=e.i,w=e.m,C=e.q,D=e.j,R=e.t,A=e.y,N=e.M,U=e.E,I=e.ag,O=e.ah,L=e.ai,T=e.s,z=e.aj,V=e.ak,j=e.T,F=e.al,P=e.am,B=e.an,G=e.ao,M=e.R,$=e.D,q=e.ap,J=e.aq,H=e.a6,W=e.ar,K=e.n,Q=e.L,X=e.ab,Y=e.as,Z=e.at,ee=e.ac,ae=e.S,le=e.U,te=e.au,ne=e.F,ue=e.G,se=e.V,ie=e.av,oe=e.aw,re=e.ax,ce=e.ay,de=e.O,pe=e.az,me=e._},e=>{ve=e.u,fe=e.t,ge=e.a,be=e.p}],execute:function(){var a=document.createElement("style");a.textContent=".recap-card[data-v-bc7ab799]{margin:16px}.recap-grid[data-v-bc7ab799]{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;text-align:center}.recap-item[data-v-bc7ab799]{display:flex;flex-direction:column}.recap-number[data-v-bc7ab799]{font-size:24px;font-weight:700}.recap-label[data-v-bc7ab799]{font-size:11px;color:var(--ion-color-medium)}.text-primary[data-v-bc7ab799]{color:var(--ion-color-primary)}.text-warning[data-v-bc7ab799]{color:var(--ion-color-warning)}.text-success[data-v-bc7ab799]{color:var(--ion-color-success)}.date-text[data-v-bc7ab799]{font-size:12px;color:var(--ion-color-medium)}.empty-state[data-v-bc7ab799]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:40px 20px;text-align:center}.empty-icon[data-v-bc7ab799]{font-size:64px;color:var(--ion-color-medium);margin-bottom:16px}.empty-state h3[data-v-bc7ab799]{margin:0 0 8px}.empty-state p[data-v-bc7ab799]{color:var(--ion-color-medium);margin:0 0 24px}.loading-state[data-v-bc7ab799]{display:flex;flex-direction:column;align-items:center;padding:40px}.status-badges[data-v-bc7ab799]{display:flex;gap:8px;margin-bottom:16px}.detail-title[data-v-bc7ab799]{font-size:24px;margin:0 0 16px}.detail-actions[data-v-bc7ab799]{margin-top:24px}ion-avatar[data-v-bc7ab799]{display:flex;align-items:center;justify-content:center}\n/*$vite$:1*/",document.head.appendChild(a);const _e={class:"recap-grid"},ye={class:"recap-item"},xe={class:"recap-number"},he={class:"recap-item"},Ee={class:"recap-number text-primary"},Se={class:"recap-item"},ke={class:"recap-number text-warning"},we={class:"recap-item"},Ce={class:"recap-number text-success"},De={class:"date-text"},Re={key:2,class:"empty-state"},Ae={key:0},Ne={key:1},Ue={key:3,class:"loading-state"},Ie={class:"status-badges"},Oe={class:"detail-title"},Le={key:1,class:"detail-actions"};e("default",me(l({__name:"SignalementsPage",setup(e){const a=r(),l=ve(),me=t(),Te=o("tous"),ze=o(!1),Ve=o(null),je=o(!1),Fe=o(null),Pe=o(!1),Be=o(""),Ge=o("success"),Me=se(()=>l.recap),$e=se(()=>"mes"===Te.value?l.mesSignalements:l.signalements),qe=[{text:"Annuler",role:"cancel"},{text:"Supprimer",role:"destructive",handler:()=>ua()}],Je=e=>fe[e]||e,He=e=>ge[e]||e,We=e=>be[e]||e,Ke=e=>({NOUVEAU:"primary",EN_COURS:"warning",RESOLU:"success",REJETE:"danger"}[e]||"medium"),Qe=e=>({NID_DE_POULE:pe,FISSURE:de,INONDATION:ce,OBSTACLE:re,ECLAIRAGE:oe,SIGNALISATION:G,AUTRE:ie}[e]||ie),Xe=e=>e?(e instanceof Date?e:new Date(e)).toLocaleDateString("fr-FR",{day:"2-digit",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"}):"Non disponible",Ye=e=>e.createdById===me.userId,Ze=async()=>{"mes"===Te.value?await l.fetchMesSignalements():await l.fetchAll(),await l.fetchRecap()},ea=async()=>{await Ze()},aa=()=>{ze.value=!1,Ve.value=null},la=()=>{a.push("/map")},ta=()=>{if(!Ve.value)return;const{latitude:e,longitude:a}=Ve.value;window.open(`https://www.google.com/maps?q=${e},${a}`,"_blank")},na=e=>{Fe.value=e,je.value=!0},ua=async()=>{if(!Fe.value)return;const e=await l.deleteSignalement(Fe.value.id);e.success?(Be.value="Signalement supprimé",Ge.value="success",aa()):(Be.value=e.message||"Erreur lors de la suppression",Ge.value="danger"),Pe.value=!0,Fe.value=null};return n(async()=>{await Ze()}),(e,a)=>(c(),u(i(ue),null,{default:s(()=>[d(i(p),null,{default:s(()=>[d(i(m),{color:"primary"},{default:s(()=>[d(i(v),{slot:"start"},{default:s(()=>[d(i(f))]),_:1}),d(i(g),null,{default:s(()=>[...a[5]||(a[5]=[b("Signalements",-1)])]),_:1}),d(i(v),{slot:"end"},{default:s(()=>[d(i(_),{onClick:Ze},{default:s(()=>[d(i(y),{icon:i(x)},null,8,["icon"])]),_:1})]),_:1})]),_:1}),d(i(m),null,{default:s(()=>[d(i(h),{modelValue:Te.value,"onUpdate:modelValue":a[0]||(a[0]=e=>Te.value=e),onIonChange:ea},{default:s(()=>[d(i(E),{value:"tous"},{default:s(()=>[d(i(S),null,{default:s(()=>[...a[6]||(a[6]=[b("Tous",-1)])]),_:1})]),_:1}),d(i(E),{value:"mes"},{default:s(()=>[d(i(S),null,{default:s(()=>[...a[7]||(a[7]=[b("Mes signalements",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),d(i(k),null,{default:s(()=>[Me.value?(c(),u(i(w),{key:0,class:"recap-card"},{default:s(()=>[d(i(C),null,{default:s(()=>[D("div",_e,[D("div",ye,[D("span",xe,R(Me.value.total),1),a[8]||(a[8]=D("span",{class:"recap-label"},"Total",-1))]),D("div",he,[D("span",Ee,R(Me.value.nouveaux),1),a[9]||(a[9]=D("span",{class:"recap-label"},"Nouveaux",-1))]),D("div",Se,[D("span",ke,R(Me.value.enCours),1),a[10]||(a[10]=D("span",{class:"recap-label"},"En cours",-1))]),D("div",we,[D("span",Ce,R(Me.value.resolus),1),a[11]||(a[11]=D("span",{class:"recap-label"},"Résolus",-1))])])]),_:1})]),_:1})):A("",!0),$e.value.length>0?(c(),u(i(N),{key:1},{default:s(()=>[(c(!0),U(I,null,O($e.value,e=>(c(),u(i(L),{key:e.id},{default:s(()=>[d(i(T),{button:"",onClick:a=>(e=>{Ve.value=e,ze.value=!0})(e)},{default:s(()=>{return[d(i(z),{slot:"start",style:V({background:(a=e.statut,{NOUVEAU:"#3880ff",EN_COURS:"#ffc409",RESOLU:"#2dd36f",REJETE:"#eb445a"}[a]||"#92949c")})},{default:s(()=>[d(i(y),{icon:Qe(e.typeProbleme),color:"light"},null,8,["icon"])]),_:2},1032,["style"]),d(i(S),null,{default:s(()=>{return[D("h2",null,R(e.titre),1),D("p",null,R(Je(e.typeProbleme))+" - "+R(e.adresse||"Sans adresse"),1),D("p",De,R((a=e.dateSignalement,(a instanceof Date?a:new Date(a)).toLocaleDateString("fr-FR",{day:"2-digit",month:"short",year:"numeric"}))),1)];var a}),_:2},1024),d(i(j),{slot:"end",color:Ke(e.statut),size:"small"},{default:s(()=>[b(R(He(e.statut)),1)]),_:2},1032,["color"])];var a}),_:2},1032,["onClick"]),Ye(e)?(c(),u(i(F),{key:0,side:"end"},{default:s(()=>[d(i(P),{color:"danger",onClick:a=>na(e)},{default:s(()=>[d(i(y),{icon:i(B),slot:"icon-only"},null,8,["icon"])]),_:1},8,["onClick"])]),_:2},1024)):A("",!0)]),_:2},1024))),128))]),_:1})):i(l).isLoading?A("",!0):(c(),U("div",Re,[d(i(y),{icon:i(G),class:"empty-icon"},null,8,["icon"]),a[13]||(a[13]=D("h3",null,"Aucun signalement",-1)),"mes"===Te.value?(c(),U("p",Ae,"Vous n'avez pas encore créé de signalement.")):(c(),U("p",Ne,"Aucun signalement n'a été enregistré.")),d(i(_),{onClick:la},{default:s(()=>[d(i(y),{icon:i(M),slot:"start"},null,8,["icon"]),a[12]||(a[12]=b(" Créer un signalement ",-1))]),_:1})])),i(l).isLoading?(c(),U("div",Ue,[d(i($),{name:"crescent"}),a[14]||(a[14]=D("p",null,"Chargement...",-1))])):A("",!0),d(i(q),{slot:"fixed",onIonRefresh:a[1]||(a[1]=e=>(async e=>{await Ze(),e.target.complete()})(e))},{default:s(()=>[d(i(J))]),_:1})]),_:1}),d(i(H),{"is-open":ze.value,onDidDismiss:aa},{default:s(()=>[d(i(p),null,{default:s(()=>[d(i(m),{color:"primary"},{default:s(()=>[d(i(v),{slot:"start"},{default:s(()=>[d(i(_),{onClick:aa},{default:s(()=>[d(i(y),{icon:i(W)},null,8,["icon"])]),_:1})]),_:1}),d(i(g),null,{default:s(()=>[...a[15]||(a[15]=[b("Détails du signalement",-1)])]),_:1})]),_:1})]),_:1}),Ve.value?(c(),u(i(k),{key:0,class:"ion-padding"},{default:s(()=>{return[D("div",Ie,[d(i(j),{color:Ke(Ve.value.statut)},{default:s(()=>[b(R(He(Ve.value.statut)),1)]),_:1},8,["color"]),d(i(j),{color:(e=Ve.value.priorite,{BASSE:"medium",NORMALE:"primary",HAUTE:"warning",URGENTE:"danger"}[e]||"medium")},{default:s(()=>[b(R(We(Ve.value.priorite)),1)]),_:1},8,["color"])]),D("h1",Oe,R(Ve.value.titre),1),d(i(j),{color:"medium"},{default:s(()=>[d(i(y),{icon:Qe(Ve.value.typeProbleme)},null,8,["icon"]),d(i(S),null,{default:s(()=>[b(R(Je(Ve.value.typeProbleme)),1)]),_:1})]),_:1}),Ve.value.description?(c(),u(i(w),{key:0},{default:s(()=>[d(i(K),null,{default:s(()=>[d(i(Q),null,{default:s(()=>[...a[16]||(a[16]=[b("Description",-1)])]),_:1})]),_:1}),d(i(C),null,{default:s(()=>[b(R(Ve.value.description),1)]),_:1})]),_:1})):A("",!0),d(i(N),null,{default:s(()=>[d(i(T),null,{default:s(()=>[d(i(y),{icon:i(X),slot:"start",color:"primary"},null,8,["icon"]),d(i(S),null,{default:s(()=>[a[17]||(a[17]=D("h3",null,"Adresse",-1)),D("p",null,R(Ve.value.adresse||"Non renseignée"),1)]),_:1})]),_:1}),d(i(T),null,{default:s(()=>[d(i(y),{icon:i(Y),slot:"start",color:"primary"},null,8,["icon"]),d(i(S),null,{default:s(()=>[a[18]||(a[18]=D("h3",null,"Coordonnées",-1)),D("p",null,R(Ve.value.latitude.toFixed(6))+", "+R(Ve.value.longitude.toFixed(6)),1)]),_:1}),d(i(_),{fill:"clear",slot:"end",onClick:ta},{default:s(()=>[d(i(y),{icon:i(Z)},null,8,["icon"])]),_:1})]),_:1}),d(i(T),null,{default:s(()=>[d(i(y),{icon:i(ee),slot:"start",color:"primary"},null,8,["icon"]),d(i(S),null,{default:s(()=>[a[19]||(a[19]=D("h3",null,"Date du signalement",-1)),D("p",null,R(Xe(Ve.value.dateSignalement)),1)]),_:1})]),_:1}),d(i(T),null,{default:s(()=>[d(i(y),{icon:i(ae),slot:"start",color:"primary"},null,8,["icon"]),d(i(S),null,{default:s(()=>[a[20]||(a[20]=D("h3",null,"Signalé par",-1)),D("p",null,R(Ve.value.createdByName||Ve.value.createdByEmail),1)]),_:1})]),_:1}),Ve.value.dateResolution?(c(),u(i(T),{key:0},{default:s(()=>[d(i(y),{icon:i(le),slot:"start",color:"success"},null,8,["icon"]),d(i(S),null,{default:s(()=>[a[21]||(a[21]=D("h3",null,"Date de résolution",-1)),D("p",null,R(Xe(Ve.value.dateResolution)),1)]),_:1})]),_:1})):A("",!0)]),_:1}),Ye(Ve.value)?(c(),U("div",Le,[d(i(_),{expand:"block",color:"danger",onClick:a[2]||(a[2]=e=>na(Ve.value))},{default:s(()=>[d(i(y),{icon:i(B),slot:"start"},null,8,["icon"]),a[22]||(a[22]=b(" Supprimer ce signalement ",-1))]),_:1})])):A("",!0)];var e}),_:1})):A("",!0)]),_:1},8,["is-open"]),d(i(te),{"is-open":je.value,header:"Confirmer la suppression",message:"Êtes-vous sûr de vouloir supprimer ce signalement ?",buttons:qe,onDidDismiss:a[3]||(a[3]=e=>je.value=!1)},null,8,["is-open"]),d(i(ne),{"is-open":Pe.value,message:Be.value,color:Ge.value,duration:3e3,onDidDismiss:a[4]||(a[4]=e=>Pe.value=!1)},null,8,["is-open","message","color"])]),_:1}))}}),[["__scopeId","data-v-bc7ab799"]]))}}});
