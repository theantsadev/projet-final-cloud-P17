#!/bin/bash
echo "üî• TESTS DE TOUS LES ENDPOINTS üî•"
echo "=================================="
echo ""

echo "1Ô∏è‚É£  INSCRIPTION (POST /api/auth/register)"
curl -X POST http://localhost:8080/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "email": "user1@test.com",
    "password": "Pass123!",
    "fullName": "User One"
  }'
echo ""
echo "---"
echo ""

echo "2Ô∏è‚É£  INSCRIPTION 2√®me utilisateur"
curl -X POST http://localhost:8080/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "email": "user2@test.com",
    "password": "Pass456!",
    "fullName": "User Two"
  }'
echo ""
echo "---"
echo ""

echo "3Ô∏è‚É£  CONNEXION USER1"
curl -X POST http://localhost:8080/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "email": "user1@test.com",
    "password": "Pass123!"
  }'
echo ""
echo "---"
echo ""

echo "4Ô∏è‚É£  CONNEXION USER2"
curl -X POST http://localhost:8080/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "email": "user2@test.com",
    "password": "Pass456!"
  }'
echo ""
echo "---"
echo ""

echo "5Ô∏è‚É£  CONNEXION √âCHOU√âE (mauvais mot de passe)"
curl -X POST http://localhost:8080/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "email": "user1@test.com",
    "password": "wrong"
  }'
echo ""
echo "---"
echo ""

echo "6Ô∏è‚É£  VOIR PARAM√àTRES S√âCURIT√â (GET /api/security/settings)"
curl -X GET http://localhost:8080/api/security/settings
echo ""
echo "---"
echo ""

echo "7Ô∏è‚É£  MODIFIER PARAM√àTRES (PUT /api/security/settings)"
curl -X PUT http://localhost:8080/api/security/settings \
  -H "Content-Type: application/json" \
  -d '{
    "maxLoginAttempts": 5,
    "sessionDurationMinutes": 30
  }'
echo ""
echo "---"
echo ""

echo "8Ô∏è‚É£  BLOQUER USER1 (3 mauvais mots de passe)"
for i in {1..3}; do
  echo "Tentative $i :"
  curl -X POST http://localhost:8080/api/auth/login \
    -H "Content-Type: application/json" \
    -d '{
      "email": "user1@test.com",
      "password": "wrong$i"
    }'
  echo ""
done
echo "---"
echo ""

echo "9Ô∏è‚É£  D√âBLOQUER USER1 (POST /api/auth/unlock)"
curl -X POST http://localhost:8080/api/auth/unlock \
  -H "Content-Type: application/json" \
  -d '{
    "email": "user1@test.com"
  }'
echo ""
echo "---"
echo ""

echo "üîü  V√âRIFIER D√âBLOCAGE"
curl -X POST http://localhost:8080/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "email": "user1@test.com",
    "password": "Pass123!"
  }'
echo ""
echo "---"
echo ""

echo "1Ô∏è‚É£1Ô∏è‚É£  TEST SYNC (GET /api/sync/status)"
curl -X GET http://localhost:8080/api/sync/status
echo ""
echo "---"
echo ""

echo "1Ô∏è‚É£2Ô∏è‚É£  SWAGGER UI"
echo "Ouvrez: http://localhost:8080/api/swagger-ui.html"
echo "---"
echo ""

echo "1Ô∏è‚É£3Ô∏è‚É£  API DOCS"
curl -X GET http://localhost:8080/api/api-docs
echo ""
echo "---"
echo ""

echo "‚úÖ TESTS TERMIN√âS"





#!/bin/bash
echo "üîê TESTS AVEC TOKENS JWT"
echo "========================"
echo ""

echo "1. Login pour obtenir token"
LOGIN_RESPONSE=$(curl -s -X POST http://localhost:8080/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "email": "user1@test.com",
    "password": "Pass123!"
  }')

echo "R√©ponse: $LOGIN_RESPONSE"
echo ""
echo "---"
echo ""

echo "2. Extraire token (manuellement)"
echo "Cherchez 'token' dans la r√©ponse ci-dessus"
echo ""
echo "---"
echo ""

echo "3. MON PROFIL (avec token manuel)"
echo "Remplacez TOKEN_ICI par votre token"
curl -X GET http://localhost:8080/api/auth/profile \
  -H "Authorization: Bearer TOKEN_ICI"
echo ""
echo "---"
echo ""

echo "4. MODIFIER PROFIL (avec token)"
curl -X PUT http://localhost:8080/api/auth/profile \
  -H "Authorization: Bearer TOKEN_ICI" \
  -H "Content-Type: application/json" \
  -d '{
    "fullName": "Nouveau Nom",
    "phone": "0123456789"
  }'
echo ""
echo "---"
echo ""

echo "5. D√âCONNEXION"
curl -X POST http://localhost:8080/api/auth/logout \
  -H "Authorization: Bearer TOKEN_ICI"
echo ""


#!/bin/bash
echo "ü§ñ TEST AUTOMATIQUE AVEC EXTRACTION TOKEN"
echo "=========================================="

# Login et extraire token
echo "1. Connexion..."
RESPONSE=$(curl -s -X POST http://localhost:8080/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "email": "user1@test.com",
    "password": "Pass123!"
  }')

# Extraire token avec grep/sed
TOKEN=$(echo $RESPONSE | grep -o '"token":"[^"]*' | cut -d'"' -f4)

if [ -z "$TOKEN" ]; then
    echo "‚ùå Erreur: Token non trouv√© dans la r√©ponse"
    echo "R√©ponse: $RESPONSE"
    exit 1
fi

echo "‚úÖ Token obtenu: ${TOKEN:0:50}..."
echo ""

echo "2. Tester avec le token..."
echo ""

echo "üìã Mon profil:"
curl -s -X GET http://localhost:8080/api/auth/profile \
  -H "Authorization: Bearer $TOKEN"
echo ""
echo ""

echo "‚úèÔ∏è  Modifier profil:"
curl -s -X PUT http://localhost:8080/api/auth/profile \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "fullName": "Nom Modifi√© Auto",
    "phone": "0987654321"
  }'
echo ""
echo ""

echo "üö™ D√©connexion:"
curl -s -X POST http://localhost:8080/api/auth/logout \
  -H "Authorization: Bearer $TOKEN"
echo ""


